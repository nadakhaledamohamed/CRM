@model CRM.Models.PersonRequestViewModel

@{
    ViewData["Title"] = "Create";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
@* <link href="~/css/dark.css" rel="stylesheet" />
 *@
 <link href="~/css/light.css" rel="stylesheet" />


@* <style>
    body {
        background-color: #0d0d1f;
        color: #e0e0ff;
    }

    .neon-form {
        background: linear-gradient(145deg, #121230, #0d0d20);
        border-radius: 20px;
        padding: 2rem;
        color: #e0e0ff;
        box-shadow: 0 0 20px rgba(224, 0, 255, 0.15);
    }

    .nav-pills .nav-link {
        color: #ccc;
        border-radius: 50px;
        transition: all 0.3s ease;
    }

        .nav-pills .nav-link.active {
            background: linear-gradient(to right, #7f00ff, #e100ff);
            color: #fff;
            box-shadow: 0 0 10px rgba(224, 0, 255, 0.6);
        }

    .form-label {
        color: #7efcfb;
        font-weight: 500;
        text-shadow: 0 0 6px rgba(103, 58, 183, 0.3);
    }

    .form-control,
    .form-select {
        background-color: #1a1a3d;
        border: 1px solid #333356;
        color: #ffffff;
        box-shadow: inset 0 0 6px rgba(103, 58, 183, 0.3);
    }

        .form-control:focus,
        .form-select:focus {
            border-color: #00ffe1;
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.6);
        }

    .btn-glow {
        background: linear-gradient(to right, #7f00ff, #e100ff);
        color: white;
        border: none;
        padding: 0.6rem 1.5rem;
        border-radius: 30px;
        box-shadow: 0 0 12px rgba(224, 0, 255, 0.5);
        transition: all 0.3s ease;
    }

        .btn-glow:hover {
            box-shadow: 0 0 18px rgba(224, 0, 255, 0.8);
            transform: scale(1.03);
        }

    .btn-cancel {
        background-color: #2c2c4a;
        color: #bbb;
        padding: 0.6rem 1.5rem;
        border-radius: 30px;
    }

        .btn-cancel:hover {
            background-color: #444465;
            color: #fff;
        }

    .tab-pane {
        animation: fadeIn 0.5s ease;
    }

    @@keyframes fadeIn {
        from

    {
        opacity: 0;
        transform: translateY(10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }

    }
</style> *@

<div class="container mt-5 neon-form">
    <h2 class="text-center mb-4"><i class="bi bi-person-plus-fill"></i> Create Person & Request</h2>

    <form asp-action="CreateWithRequest" asp-controller="Persons" method="post">
        <div asp-validation-summary="ModelOnly" class="text-danger mb-4"></div>

        <ul class="nav nav-pills mb-4 justify-content-center" id="pills-tab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="pills-person-tab" data-bs-toggle="pill" data-bs-target="#pills-person" type="button">Personal Info</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="pills-education-tab" data-bs-toggle="pill" data-bs-target="#pills-education" type="button">Education Info</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="pills-request-tab" data-bs-toggle="pill" data-bs-target="#pills-request" type="button">Request Info</button>
            </li>
        </ul>

        <div class="tab-content" id="pills-tabContent">
            <!-- PERSONAL -->
            <div class="tab-pane fade show active" id="pills-person" role="tabpanel">
                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <label asp-for="FirstName" class="form-label"></label>
                        <input asp-for="FirstName" class="form-control" />
                        <span asp-validation-for="FirstName" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="LastName" class="form-label"></label>
                        <input asp-for="LastName" class="form-control" />
                        <span asp-validation-for="LastName" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="Phone" class="form-label"></label>
                        <input asp-for="Phone" class="form-control" />
                        <span asp-validation-for="Phone" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="Email" class="form-label"></label>
                        <input asp-for="Email" class="form-control" />
                        <span asp-validation-for="Email" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="NationalId" class="form-label"></label>
                        <input asp-for="NationalId" class="form-control" />
                        <span asp-validation-for="NationalId" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="UserType" class="form-label"></label>
                        <select asp-for="UserType" class="form-select">
                            <option value="">-- Select --</option>
                            <option value="1">Applicant</option>
                            <option value="2">Guardian</option>
                        </select>
                        <span asp-validation-for="UserType" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Created At</label>
                        <input type="text" class="form-control" value="@DateTime.Now.ToString("yyyy-MM-dd HH:mm")" readonly />
                        <input type="hidden" asp-for="Person_CreatedAt" value="@DateTime.Now" />
                    </div>
                   @*  <div class="col-md-6"> 
                        <label asp-for="Person_CreatedByCode" class="form-label"></label>
                         <input asp-for="Person_CreatedByCode" class="form-control" /> 
                         <span asp-validation-for="Person_CreatedByCode" class="text-danger"></span>
                     </div> *@

                   @*  <div class="col-md-6">
                        <label asp-for="Person_CreatedByName" class="form-label">Created By</label>
                        <input asp-for="Person_CreatedByName" class="form-control bg-light" readonly
                               value="@(Model?.Person_CreatedByName ?? "Current User")" />

                        <input type="hidden" asp-for="Person_CreatedByCode" />
                    </div> *@


                </div>
            </div>

            <!-- EDUCATION -->
            <div class="tab-pane fade" id="pills-education" role="tabpanel">
                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <label asp-for="HighSchoolId" class="form-label">High School</label>
                        <select asp-for="HighSchoolId" class="form-select" asp-items="ViewBag.HighSchoolId">
                            <option value="">-- Select --</option>
                        </select>
                        <span asp-validation-for="HighSchoolId" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="CertificateId" class="form-label">Certificate</label>
                        <select asp-for="CertificateId" class="form-select" asp-items="ViewBag.CertificateId">
                            <option value="">-- Select --</option>
                        </select>
                        <span asp-validation-for="CertificateId" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="MajorId" class="form-label">Major</label>
                        <select asp-for="MajorId" class="form-select" asp-items="ViewBag.MajorId">
                            <option value="">-- Select --</option>
                        </select>
                        <span asp-validation-for="MajorId" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="HowDidYouKnowUsId" class="form-label">How Did You Know Us?</label>
                        <select asp-for="HowDidYouKnowUsId" class="form-select" asp-items="ViewBag.HowDidYouKnowUsId">
                            <option value="">-- Select --</option>
                        </select>
                        <span asp-validation-for="HowDidYouKnowUsId" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <!-- REQUEST -->
            <div class="tab-pane fade" id="pills-request" role="tabpanel">

                <div class="row g-3 mb-4">
                    <div class="col-md-12">
                        <label asp-for="Description" class="form-label"></label>
                        <textarea asp-for="Description" class="form-control" rows="3"></textarea>
                        <span asp-validation-for="Description" class="text-danger"></span>
                    </div>
                    <div class="col-md-12">
                        <label asp-for="Comments" class="form-label"></label>
                        <textarea asp-for="Comments" class="form-control" rows="2"></textarea>
                        <span asp-validation-for="Comments" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="FollowUpCount" class="form-label"></label>
                        <input asp-for="FollowUpCount" type="number" class="form-control" min="0" />
                        <span asp-validation-for="FollowUpCount" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="StatusId" class="form-label">Status</label>
                        <select asp-for="StatusId" class="form-select" asp-items="ViewBag.StatusId">
                            <option value="">-- Select --</option>
                        </select>
                        <span asp-validation-for="StatusId" class="text-danger"></span>
                    </div>
                    <input type="hidden" asp-for="Request_CreatedAt" value="@DateTime.Now" />
                    @* <div class="col-md-6"> *@
                    @*     <label asp-for="Request_CreatedByCode" class="form-label">Request Created By Code</label> *@
                    @*     <input asp-for="Request_CreatedByCode" class="form-control" /> *@
                    @*     <span asp-validation-for="Request_CreatedByCode" class="text-danger"></span> *@
                    @* </div> *@
                </div>


                  <div class="text-center mt-4">
        <button type="submit" class="btn-glow px-5" id="finalSubmitBtn">
            <i class="bi bi-check-circle"></i> Create
        </button>
        <a asp-controller="Home" asp-action="Index" class="btn-cancel ms-3 px-5">Cancel</a>
    </div>


    </div>
           


        </div>

        <!-- ACTIONS -->
       
    </form>
</div>

@section Scripts {
    <script>
        document.getElementById('finalSubmitBtn').addEventListener('click', function (e) {
          const form = document.querySelector('form');
          if (!form.checkValidity()) {
            e.preventDefault(); // stop form submission
            e.stopPropagation();

            // Add Bootstrap validation feedback classes
            form.classList.add('was-validated');

            // Optional: Notify user to check previous tabs
            alert('🚫 Please complete all required fields in the form before submitting.');

            // Optionally, switch to first tab with invalid input
            const firstInvalid = form.querySelector(':invalid');
            if (firstInvalid) {
              const tabId = firstInvalid.closest('.tab-pane')?.id;
              if (tabId) {
                const tabTrigger = document.querySelector(`[data-bs-target="#${tabId}"]`);
                const tab = new bootstrap.Tab(tabTrigger);
                tab.show();
              }
            }
          }
        });
    </script>

    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
